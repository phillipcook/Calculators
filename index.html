<!DOCTYPE html>
<html lang="en-gb">
<head>
    <meta charset="UTF-8">
    <title>Custom Calculators</title>
    <!-- **1. Add the Viewport Meta Tag** -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* **Global Styles** */
        *, *::before, *::after {
            box-sizing: border-box; /* Ensures padding and borders are included in total width and height */
        }

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 100%;
        }

        .reset-button {
            margin-bottom: 20px;
            text-align: center; /* Center the reset button */
        }

        .reset-button button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        /* **Calculator Container with CSS Grid** */
        .calculator-container {
            display: grid;
            grid-template-columns: 1fr; /* Single column by default */
            gap: 20px;
            max-width: 100%;
        }

        /* **Media Query for Larger Screens (â‰¥768px)** */
        @media (min-width: 768px) {
            .calculator-container {
                grid-template-columns: repeat(2, 1fr); /* Two columns */
            }
        }

        /* **Calculator Card Styles** */
        .calculator {
            border: 1px solid #ccc;
            padding: 20px;
            position: relative;
            background-color: #f9f9f9; /* Optional: Slight background color for better visibility */
            border-radius: 5px; /* Optional: Rounded corners */
        }

        .calculator h2 {
            margin-top: 0;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .calculator label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }

        .calculator input[type="text"],
        .calculator input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .calculator button {
            margin-top: 10px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 3px;
            background-color: #007bff;
            color: white;
        }

        .calculator button:hover {
            background-color: #0056b3;
        }

        .date-adjustment, .value-adjustment, .ltv-buttons {
            margin: 10px 0;
        }

        .date-adjustment label,
        .value-adjustment label,
        .ltv-buttons label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .date-adjustment button,
        .value-adjustment button,
        .ltv-buttons button {
            margin: 2px 2px 2px 0;
            padding: 5px 10px;
            font-size: 12px;
            border: 1px solid #007bff;
            background-color: white;
            color: #007bff;
            border-radius: 3px;
            cursor: pointer;
        }

        .date-adjustment button:hover,
        .value-adjustment button:hover,
        .ltv-buttons button:hover {
            background-color: #007bff;
            color: white;
        }

        .result {
            margin-top: 15px;
            font-weight: bold;
            color: #333;
        }

        .description {
            font-size: 12px;
            color: #555;
            margin-top: 5px;
        }

        /* **Date Picker Styles** */
        .datepicker {
            position: absolute;
            top: 60px;
            left: 0;
            z-index: 1000;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .datepicker table {
            width: 100%;
            border-collapse: collapse;
        }

        .datepicker th, .datepicker td {
            width: 14.28%;
            text-align: center;
            padding: 5px;
        }

        .datepicker th {
            background: #f0f0f0;
        }

        .datepicker td {
            cursor: pointer;
            border-radius: 3px;
        }

        .datepicker td:hover {
            background: #e0e0e0;
        }

        .datepicker .selected {
            background: #007bff;
            color: #fff;
        }

        .date-picker-button {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            vertical-align: middle;
            margin-left: 5px;
            position: relative;
            top: -3px;
        }

        /* **New CSS Class for Navigation Buttons (Optional)** */
        /* Uncomment if using CSS classes for navigation buttons */

        /*
        .nav-button {
            margin: 2px;
            padding: 2px 5px;
            font-size: 14px;
            border: 1px solid #007bff;
            background-color: white;
            color: #007bff;
            border-radius: 3px;
            cursor: pointer;
        }

        .nav-button:hover {
            background-color: #007bff;
            color: white;
        }
        */

        /* **Optional: Enhance Mobile Experience** */
        @media (max-width: 767px) {
            .calculator {
                width: 100%;
                margin-bottom: 20px;
                /* min-width: auto; Already handled by grid-template-columns */
            }
        }
    </style>
</head>
<body>

<!-- Reset Button -->
<div class="reset-button">
    <button onclick="resetAll()">Reset All</button>
</div>

<div class="calculator-container">

    <!-- Calculator 1: How long ago/until -->
    <div class="calculator" id="calculator1">
        <h2>How long ago/until</h2>
        <label for="date1">Select Date:
            <button class="date-picker-button" onclick="openDatePicker('date1')">
                ðŸ“…
            </button>
        </label>
        <input type="text" id="date1" placeholder="dd/mm/yyyy">
        <div class="date-adjustment">
            <label>Adjust Date1:</label>
            <button onclick="adjustDate('date1', 'years', 1)">+1 Year</button>
            <button onclick="adjustDate('date1', 'months', 1)">+1 Month</button>
            <button onclick="adjustDate('date1', 'days', 1)">+1 Day</button>
            <button onclick="adjustDate('date1', 'years', -1)">-1 Year</button>
            <button onclick="adjustDate('date1', 'months', -1)">-1 Month</button>
            <button onclick="adjustDate('date1', 'days', -1)">-1 Day</button>
        </div>
        <label for="date2">Second Date (optional):
            <button class="date-picker-button" onclick="openDatePicker('date2')">
                ðŸ“…
            </button>
        </label>
        <input type="text" id="date2" placeholder="dd/mm/yyyy">
        <div class="date-adjustment">
            <label>Adjust Date2:</label>
            <button onclick="adjustDate('date2', 'years', 1)">+1 Year</button>
            <button onclick="adjustDate('date2', 'months', 1)">+1 Month</button>
            <button onclick="adjustDate('date2', 'days', 1)">+1 Day</button>
            <button onclick="adjustDate('date2', 'years', -1)">-1 Year</button>
            <button onclick="adjustDate('date2', 'months', -1)">-1 Month</button>
            <button onclick="adjustDate('date2', 'days', -1)">-1 Day</button>
        </div>
        <div class="result" id="result1"></div>
    </div>

    <!-- Calculator 2: How long ago/until (Years and Months) -->
    <div class="calculator" id="calculator2">
        <h2>How long ago/until (Years and Months)</h2>
        <label for="yearsInput">Years:</label>
        <input type="number" id="yearsInput" min="0" value="0">
        <div class="value-adjustment">
            <button onclick="adjustValue('yearsInput', 1)">+1 Year</button>
            <button onclick="adjustValue('yearsInput', -1)">-1 Year</button>
        </div>
        <label for="monthsInput">Months:</label>
        <input type="number" id="monthsInput" min="0" value="0">
        <div class="value-adjustment">
            <button onclick="adjustValue('monthsInput', 1)">+1 Month</button>
            <button onclick="adjustValue('monthsInput', -1)">-1 Month</button>
        </div>
        <div class="result" id="result2"></div>
    </div>

    <!-- Calculator 3: Date Until Paid Off -->
    <div class="calculator" id="calculator3">
        <h2>Date Until Paid Off</h2>
        <label for="loanAmount">Loan Amount (Â£):</label>
        <input type="number" id="loanAmount" min="0" step="0.01">
        <label for="paymentAmount">Payment Amount (Â£):</label>
        <input type="number" id="paymentAmount" min="0" step="0.01">
        <div class="description">"CC Payment" calculates 3% of the loan amount and fills in the payment value.</div>
        <button onclick="calculateCCPayment()">CC Payment</button>
        <div class="result" id="result3"></div>
    </div>

    <!-- Calculator 4: Child Benefit Calculator -->
    <div class="calculator" id="calculator4">
        <h2>Child Benefit Calculator</h2>
        <label for="firstChild">1st Child (Â£):</label>
        <input type="number" id="firstChild" value="25.60" step="0.01">
        <label for="additionalChild">Additional Child (Â£):</label>
        <input type="number" id="additionalChild" value="16.95" step="0.01">
        <label for="numberOfChildren">Number of Children:</label>
        <input type="number" id="numberOfChildren" min="1" value="1">
        <div class="result" id="result4"></div>
    </div>

    <!-- Calculator 5: LTV Calculator -->
    <div class="calculator" id="calculator5">
        <h2>LTV Calculator</h2>
        <label for="valuationAmount">Valuation (Â£):</label>
        <input type="number" id="valuationAmount" min="0" step="0.01">
        <label for="loanAmountLTV">Loan (Â£):</label>
        <input type="number" id="loanAmountLTV" min="0" step="0.01">
        <label for="ltvPercentage">LTV (%):</label>
        <input type="number" id="ltvPercentage" min="0" max="100" step="0.01">
        <div class="ltv-buttons">
            <label>Select LTV Percentage:</label>
            <button onclick="setLTV(95)">95%</button>
            <button onclick="setLTV(90)">90%</button>
            <button onclick="setLTV(85)">85%</button>
            <button onclick="setLTV(80)">80%</button>
            <button onclick="setLTV(75)">75%</button>
            <button onclick="setLTV(70)">70%</button>
            <button onclick="setLTV(65)">65%</button>
            <button onclick="setLTV(60)">60%</button>
            <button onclick="setLTV(55)">55%</button>
            <button onclick="setLTV(50)">50%</button>
        </div>
        <div class="result" id="result5"></div>
    </div>

    <!-- Calculator 6: Max Term -->
    <div class="calculator" id="calculator6">
        <h2>Max Term</h2>
        <label for="dob">Date of Birth:
            <button class="date-picker-button" onclick="openDatePicker('dob')">
                ðŸ“…
            </button>
        </label>
        <input type="text" id="dob" placeholder="dd/mm/yyyy">
        <label for="retirementAge">Retirement Age:</label>
        <input type="number" id="retirementAge" value="70" min="0">
        <div class="result" id="result6"></div>
    </div>

</div>

<script>
    // **JavaScript Functions**
    // [Your existing JavaScript code remains unchanged]
    
    // Reset function
    function resetAll() {
        // Reset all input fields to their initial values
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            if (input.type === 'number') {
                if (input.id === 'yearsInput' || input.id === 'monthsInput') {
                    input.value = '0';
                } else if (input.id === 'retirementAge') {
                    input.value = '70';
                } else if (input.id === 'firstChild') {
                    input.value = '25.60';
                } else if (input.id === 'additionalChild') {
                    input.value = '16.95';
                } else if (input.id === 'numberOfChildren') {
                    input.value = '1';
                } else if (input.id === 'valuationAmount') {
                    input.value = '';
                } else if (input.id === 'loanAmountLTV') {
                    input.value = '';
                } else if (input.id === 'ltvPercentage') {
                    input.value = '';
                } else {
                    input.value = '';
                }
            } else if (input.type === 'text') {
                input.value = '';
            }
        });

        // Clear all result divs
        const results = document.querySelectorAll('.result');
        results.forEach(result => {
            result.innerHTML = '';
        });

        // Close any open date pickers
        closeDatePicker();

        // Re-initialize calculations
        calculateDuration();
        calculateFuturePastDate();
        calculatePayoffDate();
        calculateChildBenefit();
        calculateLTV();
        calculateMaxTerm();
    }

    // Calculator 1: How long ago/until
    function calculateDuration() {
        const date1Value = document.getElementById('date1').value;
        const date2Value = document.getElementById('date2').value;
        const resultDiv = document.getElementById('result1');

        if (!date1Value) {
            resultDiv.innerHTML = "Please enter the first date.";
            return;
        }

        const date1 = parseDate(date1Value);
        if (!date1) {
            resultDiv.innerHTML = "Please enter the first date in dd/mm/yyyy format.";
            return;
        }

        let messages = [];

        // Calculate difference between date1 and today
        const today = new Date();
        let diffWithToday = calculateDateDifference(date1, today);

        let durationMessage = formatDurationMessage(diffWithToday);
        if (diffWithToday.isPast) {
            messages.push(`${durationMessage} have passed since ${formatUKDate(date1)}.`);
        } else {
            messages.push(`${durationMessage} left until ${formatUKDate(date1)}.`);
        }

        // If date2 is provided, calculate difference between date1 and date2
        if (date2Value) {
            const date2 = parseDate(date2Value);
            if (!date2) {
                resultDiv.innerHTML = "Please enter the second date in dd/mm/yyyy format.";
                return;
            }
            let diffBetweenDates = calculateDateDifference(date1, date2);

            let durationBetweenMessage = formatDurationMessage(diffBetweenDates);
            messages.push(`${durationBetweenMessage} between ${formatUKDate(date1)} and ${formatUKDate(date2)}.`);
        }

        resultDiv.innerHTML = messages.join('<br>');
    }

    // Helper function to format duration message
    function formatDurationMessage(diff) {
        let parts = [];

        if (diff.years > 0) {
            parts.push(`${diff.years} ${diff.years === 1 ? 'year' : 'years'}`);
        }
        if (diff.months > 0) {
            parts.push(`${diff.months} ${diff.months === 1 ? 'month' : 'months'}`);
        }
        if (diff.days > 0) {
            parts.push(`${diff.days} ${diff.days === 1 ? 'day' : 'days'}`);
        }

        // If all units are zero, display "0 days"
        if (parts.length === 0) {
            parts.push('0 days');
        }

        return parts.join(', ');
    }

    // Helper function to parse date from dd/mm/yyyy format
    function parseDate(dateStr) {
        const parts = dateStr.split('/');
        if (parts.length !== 3) return null;
        const day = parseInt(parts[0], 10);
        const month = parseInt(parts[1], 10) - 1; // Months are zero-based
        const year = parseInt(parts[2], 10);
        const date = new Date(year, month, day);
        if (date && date.getMonth() === month && date.getDate() === day && date.getFullYear() === year) {
            return date;
        }
        return null;
    }

    // Helper function to calculate date difference and return an object with years, months, days
    function calculateDateDifference(startDate, endDate) {
        let isPast = endDate >= startDate;

        let start = new Date(startDate);
        let end = new Date(endDate);

        if (!isPast) {
            // Swap dates if endDate is before startDate
            [start, end] = [end, start];
        }

        let years = end.getFullYear() - start.getFullYear();
        let months = end.getMonth() - start.getMonth();
        let days = end.getDate() - start.getDate();

        if (days < 0) {
            months--;
            const previousMonth = new Date(end.getFullYear(), end.getMonth(), 0);
            days += previousMonth.getDate();
        }
        if (months < 0) {
            years--;
            months += 12;
        }

        return {
            years: years,
            months: months,
            days: days,
            isPast: isPast
        };
    }

    // Function to adjust date inputs
    function adjustDate(dateFieldId, unit, amount) {
        let dateInput = document.getElementById(dateFieldId);
        let dateValue = dateInput.value;

        let date;
        if (dateValue) {
            date = parseDate(dateValue);
            if (!date) {
                alert("Please enter the date in dd/mm/yyyy format.");
                return;
            }
        } else {
            date = new Date();
        }

        if (unit === 'years') {
            date.setFullYear(date.getFullYear() + amount);
        } else if (unit === 'months') {
            date.setMonth(date.getMonth() + amount);
        } else if (unit === 'days') {
            date.setDate(date.getDate() + amount);
        }

        dateInput.value = formatUKDate(date);

        // Recalculate after adjusting date
        calculateDuration();
    }

    // Calculator 2: How long ago/until (Years and Months)
    function calculateFuturePastDate() {
        const years = parseInt(document.getElementById('yearsInput').value) || 0;
        const months = parseInt(document.getElementById('monthsInput').value) || 0;
        const resultDiv = document.getElementById('result2');

        let currentDate = new Date();

        // Future Date
        let futureDate = new Date(currentDate);
        futureDate.setFullYear(futureDate.getFullYear() + years);
        futureDate.setMonth(futureDate.getMonth() + months);

        // Past Date
        let pastDate = new Date(currentDate);
        pastDate.setFullYear(pastDate.getFullYear() - years);
        pastDate.setMonth(pastDate.getMonth() - months);

        const futureFormattedDate = formatUKDate(futureDate);
        const pastFormattedDate = formatUKDate(pastDate);

        const message = `Future date: ${futureFormattedDate}<br>Past date: ${pastFormattedDate}`;

        resultDiv.innerHTML = message;
    }

    // Function to adjust number inputs
    function adjustValue(inputId, amount) {
        const input = document.getElementById(inputId);
        let value = parseInt(input.value) || 0;
        value += amount;
        if (value < 0) value = 0;
        input.value = value;

        // Recalculate after adjusting value
        calculateFuturePastDate();
    }

    // Calculator 3: Date Until Paid Off
    function calculatePayoffDate() {
        const loanAmount = parseFloat(document.getElementById('loanAmount').value);
        const paymentAmount = parseFloat(document.getElementById('paymentAmount').value);
        const resultDiv = document.getElementById('result3');

        if (!loanAmount || !paymentAmount) {
            resultDiv.innerHTML = "Please fill in both Loan Amount and Payment Amount.";
            return;
        }

        const startDate = new Date();
        const numberOfPayments = Math.ceil(loanAmount / paymentAmount);
        const payoffDate = new Date(startDate);
        payoffDate.setMonth(payoffDate.getMonth() + numberOfPayments);

        let diff = payoffDate - startDate;

        let years = payoffDate.getFullYear() - startDate.getFullYear();
        let months = payoffDate.getMonth() - startDate.getMonth();
        let days = payoffDate.getDate() - startDate.getDate();

        if (days < 0) {
            months--;
            days += new Date(payoffDate.getFullYear(), payoffDate.getMonth(), 0).getDate();
        }
        if (months < 0) {
            years--;
            months += 12;
        }

        const formattedPayoffDate = formatUKDate(payoffDate);
        const message = `The loan will be paid off by ${formattedPayoffDate}.<br>Remaining time: ${years} years, ${months} months, and ${days} days.`;

        resultDiv.innerHTML = message;
    }

    function calculateCCPayment() {
        const loanAmount = parseFloat(document.getElementById('loanAmount').value);
        if (!loanAmount) {
            alert("Please enter the Loan Amount first.");
            return;
        }
        const ccPayment = loanAmount * 0.03;
        document.getElementById('paymentAmount').value = ccPayment.toFixed(2);

        // Recalculate after updating payment amount
        calculatePayoffDate();
    }

    // Calculator 4: Child Benefit Calculator
    function calculateChildBenefit() {
        const firstChildAmount = parseFloat(document.getElementById('firstChild').value);
        const additionalChildAmount = parseFloat(document.getElementById('additionalChild').value);
        const numberOfChildren = parseInt(document.getElementById('numberOfChildren').value);
        const resultDiv = document.getElementById('result4');

        if (numberOfChildren < 1) {
            resultDiv.innerHTML = "Number of children must be at least 1.";
            return;
        }

        const firstChildTotal = firstChildAmount * 52;
        const additionalChildrenTotal = additionalChildAmount * 52 * (numberOfChildren - 1);
        const totalBenefit = firstChildTotal + additionalChildrenTotal;

        const formattedTotalBenefit = totalBenefit.toLocaleString('en-GB', {
            style: 'currency',
            currency: 'GBP',
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        resultDiv.innerHTML = `Total annual child benefit is ${formattedTotalBenefit}.`;
    }

    // Calculator 5: LTV Calculator
    function calculateLTV() {
        const valuationAmount = parseFloat(document.getElementById('valuationAmount').value);
        const loanAmount = parseFloat(document.getElementById('loanAmountLTV').value);
        const ltvPercentage = parseFloat(document.getElementById('ltvPercentage').value);
        const resultDiv = document.getElementById('result5');

        if (!valuationAmount) {
            resultDiv.innerHTML = "Please enter the Valuation amount.";
            return;
        }

        if (loanAmount) {
            // Loan amount is provided, calculate LTV%
            const calculatedLTV = (loanAmount / valuationAmount) * 100;
            document.getElementById('ltvPercentage').value = calculatedLTV.toFixed(2);

            const formattedLTV = calculatedLTV.toFixed(2) + '%';
            resultDiv.innerHTML = `The LTV is ${formattedLTV}.`;
        } else if (ltvPercentage) {
            // LTV% is provided, calculate Loan amount
            const calculatedLoanAmount = (ltvPercentage / 100) * valuationAmount;

            document.getElementById('loanAmountLTV').value = calculatedLoanAmount.toFixed(2);

            const formattedLoanAmount = calculatedLoanAmount.toLocaleString('en-GB', {
                style: 'currency',
                currency: 'GBP',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            resultDiv.innerHTML = `The loan amount is ${formattedLoanAmount}.`;
        } else {
            resultDiv.innerHTML = "Please enter either the Loan amount or LTV percentage.";
        }
    }

    function setLTV(value) {
        document.getElementById('ltvPercentage').value = value;
        document.getElementById('loanAmountLTV').value = '';
        calculateLTV();
    }

    // Calculator 6: Max Term
    function calculateMaxTerm() {
        const dobValue = document.getElementById('dob').value;
        const retirementAge = parseInt(document.getElementById('retirementAge').value);
        const resultDiv = document.getElementById('result6');

        if (!dobValue || !retirementAge) {
            resultDiv.innerHTML = "Please enter your Date of Birth and Retirement Age.";
            return;
        }

        const dob = parseDate(dobValue);
        if (!dob) {
            resultDiv.innerHTML = "Please enter the Date of Birth in dd/mm/yyyy format.";
            return;
        }
        const today = new Date();

        // Calculate the date when the user reaches retirement age
        const retirementDate = new Date(dob);
        retirementDate.setFullYear(dob.getFullYear() + retirementAge);

        // Calculate the difference in years, rounding down
        const diffTime = retirementDate - today;
        const diffYears = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 365));

        const message = diffYears >= 0
            ? `You have ${diffYears} years until retirement age.`
            : `You have already reached the retirement age.`;

        resultDiv.innerHTML = message;
    }

    // Helper function to format date in UK format
    function formatUKDate(date) {
        const day = ('0' + date.getDate()).slice(-2);
        const month = ('0' + (date.getMonth() + 1)).slice(-2);
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

    // Date Picker Functions
    function openDatePicker(inputId) {
        closeDatePicker();

        const input = document.getElementById(inputId);
        const calculator = input.closest('.calculator');
        const datepicker = document.createElement('div');
        datepicker.className = 'datepicker';

        // Position the datepicker relative to the input
        const inputRect = input.getBoundingClientRect();
        const calculatorRect = calculator.getBoundingClientRect();
        datepicker.style.top = (input.offsetTop + input.offsetHeight + 5) + 'px';
        datepicker.style.left = input.offsetLeft + 'px';

        let selectedDate = parseDate(input.value) || new Date();
        let currentMonth = selectedDate.getMonth();
        let currentYear = selectedDate.getFullYear();

        // Build the datepicker
        buildDatePicker();

        // Append the datepicker to the calculator
        calculator.appendChild(datepicker);

        // Prevent clicks inside the datepicker from closing it
        datepicker.addEventListener('click', function(event) {
            event.stopPropagation();
        });

        // Function to build the datepicker
        function buildDatePicker() {
            datepicker.innerHTML = '';
            const header = document.createElement('div');
            header.style.textAlign = 'center';
            header.style.marginBottom = '5px';
            header.style.display = 'flex';
            header.style.justifyContent = 'center';
            header.style.alignItems = 'center';

            // Previous Year Button
            const prevYearButton = document.createElement('button');
            prevYearButton.textContent = '<<';
            // Option 1: Using inline styles
            /*
            prevYearButton.style.marginRight = '5px';
            prevYearButton.style.padding = '2px 5px';
            prevYearButton.style.fontSize = '14px';
            */
            // Option 2: Using CSS classes
            // prevYearButton.className = 'nav-button';
            prevYearButton.onclick = function (event) {
                event.stopPropagation();
                currentYear--;
                buildDatePicker();
            };

            // Previous Month Button
            const prevButton = document.createElement('button');
            prevButton.textContent = '<';
            // Option 1: Using inline styles
            /*
            prevButton.style.marginRight = '10px';
            prevButton.style.padding = '2px 5px';
            prevButton.style.fontSize = '14px';
            */
            // Option 2: Using CSS classes
            // prevButton.className = 'nav-button';
            prevButton.onclick = function (event) {
                event.stopPropagation();
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                buildDatePicker();
            };

            // Month and Year Display
            const monthYear = document.createElement('span');
            monthYear.textContent = `${getMonthName(currentMonth)} ${currentYear}`;
            monthYear.style.margin = '0 10px';
            monthYear.style.flexGrow = '1';
            monthYear.style.textAlign = 'center';
            monthYear.style.fontWeight = 'bold';

            // Next Month Button
            const nextButton = document.createElement('button');
            nextButton.textContent = '>';
            // Option 1: Using inline styles
            /*
            nextButton.style.marginLeft = '10px';
            nextButton.style.padding = '2px 5px';
            nextButton.style.fontSize = '14px';
            */
            // Option 2: Using CSS classes
            // nextButton.className = 'nav-button';
            nextButton.onclick = function (event) {
                event.stopPropagation();
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                buildDatePicker();
            };

            // Next Year Button
            const nextYearButton = document.createElement('button');
            nextYearButton.textContent = '>>';
            // Option 1: Using inline styles
            /*
            nextYearButton.style.marginLeft = '5px';
            nextYearButton.style.padding = '2px 5px';
            nextYearButton.style.fontSize = '14px';
            */
            // Option 2: Using CSS classes
            // nextYearButton.className = 'nav-button';
            nextYearButton.onclick = function (event) {
                event.stopPropagation();
                currentYear++;
                buildDatePicker();
            };

            // Append all elements to header
            header.appendChild(prevYearButton);
            header.appendChild(prevButton);
            header.appendChild(monthYear);
            header.appendChild(nextButton);
            header.appendChild(nextYearButton);
            datepicker.appendChild(header);

            const table = document.createElement('table');
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            daysOfWeek.forEach(day => {
                const th = document.createElement('th');
                th.textContent = day;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            let date = 1;

            for (let i = 0; i < 6; i++) {
                const row = document.createElement('tr');
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement('td');
                    if (i === 0 && j < firstDay) {
                        cell.textContent = '';
                    } else if (date > daysInMonth) {
                        cell.textContent = '';
                    } else {
                        cell.textContent = date;

                        // Capture the current value of date
                        (function(d) {
                            cell.onclick = function (event) {
                                event.stopPropagation();
                                selectedDate = new Date(currentYear, currentMonth, d);
                                input.value = formatUKDate(selectedDate);
                                closeDatePicker();
                                // Trigger calculation
                                if (inputId === 'date1' || inputId === 'date2') {
                                    calculateDuration();
                                } else if (inputId === 'dob') {
                                    calculateMaxTerm();
                                }
                            };
                        })(date);

                        if (date === selectedDate.getDate() && currentMonth === selectedDate.getMonth() && currentYear === selectedDate.getFullYear()) {
                            cell.classList.add('selected');
                        }
                        date++; // Increment date after setting up event handler
                    }
                    row.appendChild(cell);
                }
                tbody.appendChild(row);
            }
            table.appendChild(tbody);
            datepicker.appendChild(table);
        }
    }

    function closeDatePicker() {
        const datepickers = document.querySelectorAll('.datepicker');
        datepickers.forEach(dp => dp.parentNode.removeChild(dp));
    }

    function getMonthName(monthIndex) {
        const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];
        return monthNames[monthIndex];
    }

    // Close datepicker when clicking outside
    document.addEventListener('click', function (event) {
        if (!event.target.closest('.datepicker') && !event.target.classList.contains('date-picker-button')) {
            closeDatePicker();
        }
    });

    // Event listeners for automatic calculations
    document.getElementById('date1').addEventListener('input', calculateDuration);
    document.getElementById('date2').addEventListener('input', calculateDuration);

    document.getElementById('yearsInput').addEventListener('input', calculateFuturePastDate);
    document.getElementById('monthsInput').addEventListener('input', calculateFuturePastDate);

    document.getElementById('loanAmount').addEventListener('input', calculatePayoffDate);
    document.getElementById('paymentAmount').addEventListener('input', calculatePayoffDate);

    document.getElementById('firstChild').addEventListener('input', calculateChildBenefit);
    document.getElementById('additionalChild').addEventListener('input', calculateChildBenefit);
    document.getElementById('numberOfChildren').addEventListener('input', calculateChildBenefit);

    document.getElementById('valuationAmount').addEventListener('input', calculateLTV);

    document.getElementById('loanAmountLTV').addEventListener('input', function () {
        document.getElementById('ltvPercentage').value = '';
        calculateLTV();
    });

    document.getElementById('ltvPercentage').addEventListener('input', function () {
        if (!document.getElementById('loanAmountLTV').value) {
            calculateLTV();
        }
    });

    document.getElementById('dob').addEventListener('input', calculateMaxTerm);
    document.getElementById('retirementAge').addEventListener('input', calculateMaxTerm);

    // Initial calculations
    calculateDuration();
    calculateFuturePastDate();
    calculatePayoffDate();
    calculateChildBenefit();
    calculateLTV();
    calculateMaxTerm();
</script>

</body>
</html>
